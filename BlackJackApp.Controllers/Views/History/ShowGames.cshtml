@model IEnumerable<ShowGamesHistoryViewModel>
<!DOCTYPE html>
<html>
<head>
    <title></title>
    <link rel="stylesheet" href="styles/kendo.common.min.css" />
    <link rel="stylesheet" href="styles/kendo.default.min.css" />
    <link rel="stylesheet" href="styles/kendo.default.mobile.min.css" />

    <script src="js/jquery.min.js"></script>
    <script src="js/kendo.all.min.js"></script>


</head>
<body>
    <div id="grid"></div>
    <script>
        var offset = 0;

        $("#grid").kendoGrid({
                dataSource: {
                    transport: {
                        read: {
                            url: "@Url.Action("GetGames", "History")",
                            dataType: "json",
                            type: "post"
                        }
                    },
            },
            height: 600,
                columns: [
                    { field: "GameId", title: "Id" },
                    { field: "HumanName", title: "Name" },
                    {
                        field: "GameCreation",
                        title: "Date",
                        type: "date",
                        format: "{0:MMMM/dd/yyyy H:mm}"
                    },
                    { command: { text: "Details", click: showDetails}, title: " ", width: "180px" }
                ]
            });

        $(".k-grid-content").on("scroll", function () {
            if ($(this).scrollTop() + $(this).innerHeight() >= $(this)[0].scrollHeight) {
                var grid = $("#grid").data("kendoGrid");
                offset += 10;
                $.ajax(
                    {
                        type: 'POST',
                        url: '@Url.Action("Test2", "History")',
                        data: {offset: offset},
                        dataType: 'json',
                        success: function (result) {
                            for (var i = 0; i < result.length; i++) {
                                var date = new Date(result[i].GameCreation);
                                grid.dataSource.add({ GameId: result[i].GameId, HumanName: result[i].HumanName, GameCreation: date });
                            }
                        }
                    });
            }
        });

        function showDetails(e) {
               e.preventDefault();
               var dataItem = this.dataItem($(e.currentTarget).closest("tr"));
               Id = dataItem.GameId;
               window.open("@Url.Action("Details", "History")/" + Id);
        };
    </script>
</body>
</html>